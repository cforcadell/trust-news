#Previa para que funcione Hardhat y chainlink se pueda conectar

Arrancar desde ~/blockchain/tfm/smart-contracts

npx hardhat node --hostname 0.0.0.0




comprobar  curl http://127.0.0.1:8545/ desde el anfitrion o 

desde dentro del contenedor 

docker exec -it -u root e31ecd99b6be bash


curl http://host.docker.internal:8545
# o usando la IP del host
curl http://172.17.0.1:8545

# si no va
#para probar conectividad, abrir session


apt update
apt install -y telnet

telnet 172.17.0.1 22
telnet 172.17.0.1 8545





@ Compose 
docker compose build

Si quieres forzar reconstrucci√≥n ignorando cach√©:

docker compose build --no-cache

docker compose up

@Para borrar servicios eliminados a√±adir

 --remove-orphans

# en una sola orden buiil + up
docker-compose up --build

# dettached mode
docker compose up -d

docker compose ps

docker compose logs -f

docker compose logs -f ipfs-fastapi

Detener contenedores sin borrar vol√∫menes:

docker compose stop

Detener y borrar contenedores, redes y vol√∫menes asociados:

docker compose down

docker compose down -v

# Conectar con BBDD
psql -h localhost -U chainlink -d chainlink

#up selected services
docker compose -f 'docker-compose.yml' up   'postgres' 'chainlink' 



docker compose -f 'docker-compose.yml' up    'zookeeper' 'kafka' 'ipfs'

-- TOTAL
docker compose -f 'docker-compose.yml' up    'zookeeper' 'kafka' 'ipfs' 'generate-asertions' 'news-handler' 'news-chain' 'ipfs-fastapi'  'generate-asertions'   'validate-asertions-worker_1' 'validate-asertions-worker_2' 'validate-asertions-worker_3' 'mongodb'
docker compose -f 'docker-compose.yml' down    'zookeeper' 'kafka'  'ipfs' 'generate-asertions' 'news-handler' 'news-chain' 'ipfs-fastapi'  'generate-asertions'    'validate-asertions-worker_1' 'validate-asertions-worker_2' 'validate-asertions-worker_3' 'mongodb'


docker compose -f 'docker-compose.yml' up    'zookeeper' 'kafka' 'ipfs'  
docker compose -f 'docker-compose.yml' up 'ipfs-fastapi'  'generate-asertions'   'news-handler' 'news-chain' 'mongodb' 'validate-asertions-worker_1' 'validate-asertions-worker_2' 'validate-asertions-worker_3' 
docker compose -f 'docker-compose.yml' down 'ipfs-fastapi'  'generate-asertions'   'news-handler'  'news-chain' 'mongodb' 'validate-asertions-worker_1' 'validate-asertions-worker_2' 'validate-asertions-worker_3' 




docker compose -f 'docker-compose.yml' down     'generate-asertions' 'news-handler' 'mongodb'
docker compose -f 'docker-compose.yml' up    'generate-asertions'
docker compose -f 'docker-compose.yml' up  'news-handler'
docker compose -f 'docker-compose.yml' down  'news-chain'



tests
-----

docker compose -f docker-compose.test.yml  build





PARTED
------

docker compose -f docker-compose.base.yml build
docker compose -f docker-compose.base.yml up
docker compose -f docker-compose.base.yml down

docker compose  -f docker-compose.blockchain.yml build
docker compose  -f docker-compose.blockchain.yml up
docker compose  -f docker-compose.blockchain.yml down

docker compose  -f docker-compose.apis.yml build
docker compose  -f docker-compose.apis.yml up
docker compose  -f docker-compose.apis.yml down

docker compose -f docker-compose.tests.yml build
docker compose -f docker-compose.tests.yml up
docker compose -f docker-compose.tests.yml down

cd smart-contracts
npx hardhat run scripts/deploy.js --network localnet





C√≥mo funciona

‚úÖ Autom√°tico:
Cada nodo comprueba si existe /root/.ethereum/geth
‚Üí si no, ejecuta geth init /ethereum/genesis.json.
‚Üí Luego arranca el nodo normal.

‚úÖ Sin comandos manuales, todo ocurre dentro del contenedor.

‚úÖ Montaje limpio:

/ethereum ‚Üí contiene genesis.json, passwords.txt, y (opcionalmente) node1_enode.txt.

/root/.ethereum ‚Üí datos persistentes del nodo.

üß† Conectar los dos nodos

Para que el nodo 2 se conecte al 1:

Levanta el primero:

docker compose up -d geth-node1


Obt√©n el enode:

docker exec geth-node1 geth attach http://localhost:8545 --exec "admin.nodeInfo.enode"


Copia la cadena resultante (por ejemplo):

enode://abcdef1234...@geth-node1:30303


Gu√°rdala en tu host en:

./ethereum/node1_enode.txt


Luego levanta todo:

docker compose up -d


As√≠, el segundo nodo leer√° autom√°ticamente el enode desde /ethereum/node1_enode.txt.