-- Instala reqs en venv

python3 -m venv venv

source venv/bin/activate



requirements.txt
-----------------
aiokafka==0.10.0
pytest
pytest-asyncio


pip install -r requirements.txt

python3 test_kafka.py


test_extraer_integration.py
---------------------------
C√≥mo usarlo

Guarda este archivo en:

/api/tests/test_extraer_integration.py


Aseg√∫rate de que el contenedor FastAPI est√© corriendo (por ejemplo, en el docker-compose.yml algo as√≠):

services:
  news-handler:
    build: ./api
    ports:
      - "8072:8072"


Lanza los tests (desde dentro o fuera del contenedor):

pytest -v -m integration


o, si prefieres sin marcar:

pytest -v test_extraer_integration.py


Si lo ejecutas dentro del compose, puedes definir una variable de entorno en el test service:

environment:
  - API_BASE_URL=http://news-handler:8072


test_ipfs_integration.py
------------------------
C√≥mo integrarlo

Guarda el archivo en:

/api/tests/test_ipfs_integration.py


En tu docker-compose.yml, aseg√∫rate de tener el servicio ipfs-agent expuesto, por ejemplo:

services:
  ipfs-agent:
    build: ./ipfs-agent
    ports:
      - "8090:8090"
    environment:
      - API_BASE_URL=http://ipfs-agent:8090


Lanza los tests (dentro o fuera del contenedor):

pytest -v -m integration

‚úÖ Resultado esperado

test_ipfs_upload_with_content_bytes: Subir√° un documento al IPFS local y mostrar√° el CID.

test_ipfs_upload_without_content: Comprobar√° que devuelve HTTP 400.

test_ipfs_get_invalid_cid: Validar√° el manejo de errores al consultar un CID falso.

test_news-chain_integration.py
------------------------------
Integraci√≥n con Docker Compose

En tu docker-compose.yml a√±ade algo como:

services:
  trustmanager:
    build: ./trustmanager
    ports:
      - "8074:8074"
    environment:
      - API_BASE_URL=http://trustmanager:8074
      - RPC_URL=http://ganache:8545
      - ACCOUNT_ADDRESS=0x2222222222222222222222222222222222222222
      - PRIVATE_KEY=0x...
      - CONTRACT_ADDRESS=0x3333333333333333333333333333333333333333


Y para ejecutar los tests:

pytest -v -m integration

üîç Qu√© valida este test
Endpoint	Validaci√≥n principal	Tolerancia a fallo
/publishNew	Estructura correcta y env√≠o de datos blockchain	Acepta 500 si el nodo no est√° disponible
/getNewByHash y /getNewByCid	Consulta b√°sica de posts	Acepta 500 si el contrato no responde
/getAsertionsWithValidations/{id}	Recuperaci√≥n de aserciones y validaciones	Acepta 500 si el SC no est√° desplegado


test_validator_api.py
---------------------

Ejecuci√≥n manual

Desde tu entorno local (si el contenedor est√° corriendo):

pytest -v test_validator_api.py


O bien dentro del contenedor:

docker exec -it news-validator pytest -v /app/tests/test_validator_api.py

üîß Integraci√≥n con docker-compose

Puedes a√±adirlo f√°cilmente al servicio del validador con un bloque opcional:

services:
  validator:
    build: ./validator
    ports:
      - "8084:8080"
    env_file:
      - .env
    depends_on:
      - kafka
    command: >
      sh -c "pytest -v tests/test_validator_api.py && uvicorn main:app --host 0.0.0.0 --port 8080"


test_orchestrator_publish.py
----------------------------

      Puedes a√±adirlo en api/tests/ y ejecutarlo con:

pytest -v -s test_orchestrator_publish.py


o, si prefieres unittest:

python3 -m unittest test_orchestrator_publish.py

Instrucciones

Guarda este archivo como:

api/tests/test_orchestrator_publish.py


En tu docker-compose.yml, aseg√∫rate de tener el contenedor de orquestador accesible en el puerto que indiques en BASE_URL.

Por ejemplo:

orchestrator:
  build: ./orchestrator
  ports:
    - "8085:8085"


Instala las dependencias de test (si no est√°n):

pip install pytest requests


Ejecuta los tests:

pytest -v -s
